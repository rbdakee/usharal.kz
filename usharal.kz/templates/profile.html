<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}} - My Profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="preload" as="style" href="{{url_for('static', filename='css/styleSecond.css')}}">
    <link rel="preload" as="style" href="{{url_for('static', filename='css/styleI.css')}}">
    <link rel="preload" as="style" href="{{url_for('static', filename='css/new-post.css')}}">
    <style>
    input:focus{
        border: 2px solid #ffc53a;
        outline: none;}
        .booleanValue {
            display: none;
        }

        .status {
            background-color: #ffe8e8;
            width: 100%;
            padding: 10px 20px;
            font-size: large;
        }

        .boxConfirm input.activeInput {
            border: 1px solid rgba(255, 0, 0, 0.877) !important;
        }
        .editProfileForm input{
            padding: 5px 10px;
            width: 80%;
            }
    </style>
</head>
<body>
<!-- Navbar -->

<header id="header" class="backgroundNavbar fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <div  class="languageAppear992">
                <a href="/{{lang}}" class="navbar-brand">{{title}}</a>
                <input type="hidden" name="" id="lang_hidden" value="{{lang}}" >
                <div class="d-flex languageAppear">
                    <a href="ru" class="nav-link grayyy">рус&nbsp; |</a>
                    <a href="kz" class="nav-link grayyy p-0 pt-2">қаз</a>
                </div>
            </div>
            <!-- <a href="/{{lang}}" class="navbar-brand">{{title}}</a> -->
            <input type="hidden" name="" id="lang_hidden" value="{{lang}}" >
            <div class="d-flex">
                <div class="profileLink">
                    {% if username %}
                    <li class="nav-item profileLink ">
                        <a href="/my_profile/{{lang}}" class="nav-link ps-0"><i class="fa-regular fa-user" style="color: #FFFFFF8C"></i></a>
                    </li> 
                    {% else %}
                    <li class="nav-item profileLink ">
                        <a href="/signin/{{lang}}" class="nav-link ps-0"><i class="fa-regular fa-user" style="color: #FFFFFF8C"></i></a>
                    </li> 
                    {% endif %}           
                </div>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target = "#navContent"
                aria-controls="navContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
            </div>
            
            <div class="collapse navbar-collapse" id="navContent">
                <ul class="navbar-nav mb-3 mb-lg-0 w-100 d-flex justify-content-between">
                    <li class="nav-item disappearWhen992">
                        <div class="d-flex">
                            <a href="ru" class="nav-link grayyy">рус&nbsp;&nbsp; |</a>
                            <a href="kz" class="nav-link grayyy p-0 pt-2">қаз</a>
                        </div>
                    </li>
                    

                    

                    <li class="nav-item">
                        <div class="d-flex">
                          
                            
                            <div class="dropdown p-0 m-0">
                                <button type="button" class="no-button nav-link pt-2 m-0 lng-personal" data-bs-toggle="dropdown">
                                    <i class="fa-regular fa-user" style="margin-right: 3px;"></i> Личный кабинет <i class="fa-solid fa-chevron-down" style="color: #6e6e6e; "></i>
                                </button>
                                <ul class="dropdown-menu" style="box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px; border-radius: 10px;">
                                  <li><a class="dropdown-item lng-message" href="/messages/{{lang}}">Сообщения</a></li>
                                  <li><a class="dropdown-item lng-myPosts" href="/my_posts/{{lang}}">Мои объявления</a></li>
                                  <li><a class="dropdown-item lng-payment" href="/payments/{{lang}}">Платежи и счет</a></li>
                                  <li><a class="dropdown-item lng-myProfile" href="/my_profile/{{lang}}">Мой профиль</a></li>
                                  <li><hr class="dropdown-divider"></li>
                                  <li><a class="dropdown-item lng-exit" href="/logout">Выйти</a></li>
                                </ul>
                            </div>
                        </div>                         
                    </li>
                    

                    <li class="nav-item">
                        <a href="/favorites/{{lang}}" class="nav-link lng-favourite"><i class=" fa-regular fa-heart"></i>&nbsp;Избранное</a>
                    </li>

                    <li class="nav-item">
                        <a href="/messages/{{lang}}" class="nav-link lng-message-second"><i class="fa-regular fa-comment"></i>&nbsp;Сообщения</a>
                    </li>
                    
                   
                    <li  class="d-flex">
                        <a  href="/new_post/{{lang}}" class="btn btn-outline-warning lng-newPost">Подать обьявление</a>
                    </li> 
                    {% if username %}
                        <li class="nav-item">
                            <a href="/my_profile/{{lang}}" class="nav-link profileNone">&nbsp;{{username}}</a>
                        </li>
                        {% else %}
                        <li class="nav-item">
                            <a href="/signin/{{lang}}" class="nav-link profileNone">&nbsp;Log in</a>
                        </li>
                        {% endif %}
                </ul>
                
                
                
            </div>
        </div>
    </nav>
</header>

<!-- Navbar ends -->


    <div style="margin-top: 55px;"></div>
<!-- Categories -->

    <div class="categories">
        
    

    </categories>

<!-- End Categories -->
<div class="w-100 bg-white pages">
    <div class="length">
        <div class="messageText lng-myProfile">Мой профиль</div>
        <div class=" page mt-2 flex-wrap">
            <a href="/messages/{{lang}}" class="links"><div class="text lng-message">Сообщения</div></a>
            <a href="/my_posts/{{lang}}" class="links"><div class="text lng-myPosts">Мои обьявления</div></a>
            <a href="/payments/{{lang}}" class="links"><div class="text lng-payment">Платежи и счёт</div></a>
            <a href="/my_profile/{{lang}}" class="links"><div class="text lng-myProfile" style="color: rgb(255,197,58); border-bottom: 3px solid rgb(255,197,58);">Мой профиль</div></a>
        </div>
    </div>
</div>

    

<section class="myProfile">
    {% block content %}
    <div class="myProfileInner prof">
        <div class="box boxForMainInformation">
            <div class="mainTitle inner">
                <h1 class="lng-seeProfile">Посмотреть профиль</h1>
            </div>
            <div class="spanWithInput inner">
                <div><span class="firstPart lng-yourProfile">Ваше имя</span></div>
                <div class="nameOfUser rInfo">
                    {{username}}
                </div>
            </div>
            <div class="spanWithInput inner">
                <div><span class="firstPart lng-photoOrLogo">Фото или логотип</span><span
                        class="secondPart"> </span></div>
                {% if user.logo != 0 %}
                <div class="imageBoxProfile">
                    <img loading="lazy" src="data:;base64, {{user.logo}}" width="50" alt="" class="imageOfUserChoose">
                </div>
                {% else %}
                <div class="imageBoxProfile">
                    <img loading="lazy" src="{{url_for('static', filename='img/user.svg')}}" width="50" alt=""
                        class="imageOfUserChoose">
                </div>
                {% endif %}


            </div>
            <div class="spanWithInput inner phoneSpan">
                <div><span class="firstPart">Номер WhatsApp</span><span class="secondPart"></span></div>
                {% if user.whatsapp_number %}
                <input class="userAddress rInfo" readonly value="{{user.whatsapp_number}}" type="text">
                {% else %}
                <input class="userAddress rInfo" readonly type="text">
                {% endif %}
            </div>
            <div class="spanWithInput inner phoneSpan">
                <div><span class="firstPart">Телефон</span><span class="secondPart"></span></div>
                {% if user.phone_number==0 %}
                <input type="text" value="" readonly class="profileNum userAddress rInfo" re />
                {% else %}
                <input type="text" value="{{user.phone_number}}" readonly class="profileNum userAddress rInfo" re />
                {% endif %}
            </div>
            <div class="saveLine inner">
                <button class="changeProfile lng-changeProfile" onclick="openEdit()">Редактировать профиль</button>
            </div>
        </div>

    </div>
    <form action="/my_profile/{{lang}}" class=" editProfileForm booleanValue" method="POST" enctype="multipart/form-data">
        <div class="myProfileInner changeProf">
            <div class="box boxForMainInformation">
                <div class="mainTitle inner">
                    <h1 class="lng-changeProfile">Редактировать профиль</h1>
                </div>
                <div class="spanWithInput inner">
                    <div class='booleanValue' style="display: none;">{{value}}</div>
                    <div><span class="firstPart lng-yourProfile">Ваше имя</span><span
                            class="secondPart lng-atleast4"> (не менее 4 символов)</span></div>
                    <input type="text" name="username" value="{{username}}">
                </div>
                <div class="spanWithInput inner">
                    <div><span class="firstPart lng-photoOrLogo">Фото или логотип</span><span
                            class="secondPart lng-format"> (Формат - jpg или png, максимальный размер 5
                            Мб)</span></div>
                    <div class="imageBoxProfile">
                        <img loading="lazy" src="{{url_for('static', filename='img/user.svg')}}" width="50" alt=""
                            class="imageOfUserChoose">
                        <input type="file" onchange="showFileProfile(this)"
                            accept="image/gif, image/jpeg, image/png, image/svg" name="logo"
                            class="file">
                    </div>

                </div>
                <div class="spanWithInput inner phoneSpan">
                    <div><span class="firstPart">Номер WhatsApp</span><span class="secondPart"></span></div>
                    {% if user.whatsapp_number %}
                    <input type="tel" class="profileNum" name="whatsapp_number" value="{{user.whatsapp_number}}">
                    {% else %}
                    <input type="tel" class="profileNum" name="whatsapp_number">
                    {% endif %}
                </div>

                <div class="spanWithInput inner phoneSpan">
                    <div><span class="firstPart">Телефон</span><span class="secondPart"></span></div>
                    {% if user.phone_number == 0 %}
                    <input type="tel" class="profileNum" name="phone_number">
                    {% else %}
                    <input type="tel" class="profileNum" name="phone_number"
                        value="{{user.phone_number}}">
                    {% endif %}
                </div>
                
                <!-- <div class="saveLine inner">
                    <button class="save">Сохранить</button>
                </div> -->
            </div>
            <div class="box boxForChangingPassword">
                <div class="mainTitle inner">
                    <h1 class="lng-changePass">Изменить пароль</h1>
                </div>
                <div class="spanWithInput inner">
                    <div><span class="firstPart lng-newPass">Новый пароль</span><span
                            class="secondPart"></span></div>
                    <input type="password" name="password" class="forValid">
                </div>

                <div class="spanWithInput inner">
                    <div><span class="firstPart lng-confirmPass">Повторите пароль</span><span
                            class="secondPart"></span></div>
                    <input type="password" oninput="checkForValidation(this)">
                </div>
                <div class="status booleanValue" style="color: red;"></div>
                <div class="saveLine inner">
                    <!-- <button class="saveNewPassword lng-changePass">Изменить пароль</button> -->
                </div>
            </div>
            <div class="box boxConfirm">
                <div class="mainTitle inner">
                    <h1 class="lng-confirm">Подтверждение</h1>
                </div>
                <div class="confirmButtonLine inner">
                    {% for msg in get_flashed_messages() %}
                    <a>{{msg}}</a>
                    {% endfor %}
                    <div><span class="firstPart lng-currentPass">Введите текущий пароль</span></div>
                    <input type="password" name="userPrevPassword" class="userPrevPassword activeInput"
                        oninput="prevPassword(this)" required>
                    <!-- <div>{{userpass}}</div> -->
                    <!-- <div class="status" style="color: red;"></div> -->
                    <button type="submit" style="margin-top: 10px;" class="lng-changeNew">Сохранить изменения</button>
                </div>

            </div>

        </div>
    </form>
</section>
{% endblock content %}


       

    <div style="height: 100px;">
    
    
    
    
    </div>

<!-- products end -->

<footer class="text-center text-white ">
    <!-- Grid container -->
    <div class="container p-4 d-flex justify-content-around">
     
    <div class="col-md-6 col-xs-12 me-1">
        <h4 class="textF text-center text-warning">usharal.market</h4>
        <p>@ 2023 usharal.market - все права<br> защищены</p>
    </div>
    <div class="col-md-6 col-xs-12 ms-1">
        <h4 class="textF text-center text-warning">Контакты</h4>
        <p>usharal.market@gmail.com</p>
        <p>+7 (705) 685 80 00</p>
    </div>

    </div>
    <!-- Grid container -->

   
  </footer>
      
    <!-- End Categries  -->
    

    <script src="{{url_for('static', filename='js/imask.js')}}"></script>
    <script>
    const openEdit = () => {
        document.querySelector('.editProfileForm').classList.remove('booleanValue')
        document.querySelector('.myProfileInner.prof').classList.add('booleanValue')
        }
    var phoneMask = IMask(
    document.querySelectorAll('.profileNum')[2], {
    
      mask: '+{7} (000) 000-00-00'
    });
var seephoneMask = IMask(
    document.querySelectorAll('.profileNum')[1], {
    
      mask: '+{7} (000) 000-00-00'
    });
       function myFunction() {
  var x = document.getElementById("block");
  var y = document.getElementById("block1");
  var z = document.getElementById("btna");
  var a = document.getElementById("deletea");
  if (x.style.display === "none") {
    x.style.display = "block";
  } else {
    x.style.display = "none";
  }
  if (y.style.display === "none") {
    y.style.display = "block";
  } else {
    y.style.display = "none";
  }
  if (z.style.block === "block") {
    z.style.display = "none"
  } else {
    z.style.display = "none";
  }
  if (a.style.block === "none") {
    a.style.display = "block"
  } else {
    a.style.display = "block";
  }
  let array = document.getElementsByClassName('rInfo');
  for(let i = 0; i < array.length; i++){
    array[i].readOnly = false;
  }
  document.getElementsByClassName('rInfo').readOnly = false;

}

function showFileProfile(input){
    fileProf = input.files[0]
    input.previousElementSibling.src = URL.createObjectURL(fileProf)
    input.previousElementSibling.style.height = getComputedStyle(input.parentNode).height
    input.previousElementSibling.style.width = getComputedStyle(input.parentNode).width
  }

function saveFunction() {
  var x = document.getElementById("block");
  var y = document.getElementById("block1");
  var z = document.getElementById("btna");
  var a = document.getElementById("deletea");
  if (x.style.display === "block") {
    x.style.display = "none";
  } else {
    x.style.display = "block";
  }
  if (y.style.display === "block") {
    y.style.display = "none";
  } else {
    y.style.display = "block";
  }
  if (z.style.block === "none") {
    z.style.display = "block"
  } else {
    z.style.display = "block";
  }
  if (a.style.block === "block") {
    a.style.display = "none"
  } else {
    a.style.display = "none";
  }

  let array = document.getElementsByClassName('rInfo');
  for(let i = 0; i < array.length; i++){
    array[i].readOnly = true;
  }
  document.getElementsByClassName('rInfo').readOnly = true;

}


        </script>
    <script>
        let gallery = document.getElementsByClassName('gallery')[0];
        let myPhoto = document.getElementsByClassName('photoChoosen')[0];

        function changeInputPhoto(input){
            // console.log(input);
            let file = input.files[0];
            // console.log(file);
            let reader = new FileReader();
            reader.readAsDataURL(file);

            reader.onload = function () {
                // let changeImage = document.getElementsByClassName('photoChoosen')[0];
                myPhoto.style.backgroundImage = reader.result;
                let changeImage = document.createElement('img');
                myPhoto.style.backgroundImage = "url("+`${reader.result}`+")";
            }
            

        }

        function deletePhoto() {
            document.getElementsByClassName('photoChoosen')[0].style.backgroundImage="url(./img/nophoto.png)";
    // background-image: url(./img/nophoto.png);

        }



        
        document.getElementsByClassName("photo")[0].style ="color: transparent; border: 3px solid  #ffc53a;";
        // document.getElementsByClassName('.photo')[0].style.objectFit = 'cover'
    </script>

    <script>
                
                window.addEventListener("DOMContentLoaded", function() {
    [].forEach.call( document.querySelectorAll('.tel'), function(input) {
    var keyCode;
    function mask(event) {
        event.keyCode && (keyCode = event.keyCode);
        var pos = this.selectionStart;
        if (pos < 3) event.preventDefault();
        var matrix = "+7 (___) ___ _____",
            i = 0,
            def = matrix.replace(/\D/g, ""),
            val = this.value.replace(/\D/g, ""),
            new_value = matrix.replace(/[_\d]/g, function(a) {
                return i < val.length ? val.charAt(i++) || def.charAt(i) : a
            });
        i = new_value.indexOf("_");
        if (i != -1) {
            i < 5 && (i = 3);
            new_value = new_value.slice(0, i)
        }
        var reg = matrix.substr(0, this.value.length).replace(/_+/g,
            function(a) {
                return "\\d{1," + a.length + "}"
            }).replace(/[+()]/g, "\\$&");
        reg = new RegExp("^" + reg + "$");
        if (!reg.test(this.value) || this.value.length < 5 || keyCode > 47 && keyCode < 58) this.value = new_value;
        if (event.type == "blur" && this.value.length < 5)  this.value = ""
    }

    input.addEventListener("input", mask, false);
    input.addEventListener("focus", mask, false);
    input.addEventListener("blur", mask, false);
    input.addEventListener("keydown", mask, false)

  });

});
            
            </script>
    <script>

        // function checkForValidation(el) {
        //     let val = document.getElementsByClassName('checkVal')[0].value;
            
        //     if(val != el.value){
        //         document.getElementsByClassName('dis')[0].classList.add('displayUnset');
        //     }else{
        //         document.getElementsByClassName('dis')[0].classList.remove('displayUnset');
        //         document.getElementsByClassName('dis')[0].classList.add('displayNone');
        //     }

        //     // console.log(val)

        // }


        function checkForValidation(el){
        console.log(el.value,document.querySelector('.forValid').value, el.value==document.querySelector('.forValid').value)
    if(el.value != document.querySelector('.forValid').value){
        document.querySelector('.status').classList.remove('booleanValue')
        document.querySelector('.status').innerHTML = 'Данные не совпадают'
        document.querySelector('.confirmButtonLine .lng-changeNew').disabled = true
    }
    else{
        document.querySelector('.status').classList.add('booleanValue')
        document.querySelector('.confirmButtonLine .lng-changeNew').disabled = false
    }
}



function prevPassword(el){
    if(el.value.length == 0){
        document.querySelector('.boxConfirm input').classList.add('activeInput')
        document.querySelector('.confirmButtonLine .lng-changeNew').disabled = true
    }
    else{
        document.querySelector('.boxConfirm input').classList.remove('activeInput')
        document.querySelector('.confirmButtonLine .lng-changeNew').disabled = false
    }
}
    </script>
    <script src="https://kit.fontawesome.com/06eeb4d8bd.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="{{url_for('static', filename='js/lang.js')}}"></script>
</body>
</html>